name: Build ZMK Firmware

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        board: [ "nice_nano_v2" ] # Thay đổi nếu dùng board khác
        shield: [ "kestrel47" ]   # Tên shield từ file metadata
        side: [ "left", "right" ] # Nếu là bàn phím chia đôi
        include:
          - board: nice_nano_v2
            shield: kestrel47
            side: left
            artifact_name: kestrel47_left
          - board: nice_nano_v2
            shield: kestrel47
            side: right
            artifact_name: kestrel47_right

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          submodules: recursive

      - name: Build Firmware
        uses: zmkfirmware/zmk-build-action@v0.3.0
        with:
          board: ${{ matrix.board }}
          shield: ${{ matrix.shield }}
          side: ${{ matrix.side }}
          keymap: alpha # Tên keymap mặc định từ file .keymap

      - name: Upload Firmware Artifact
        uses: actions/upload-artifact@v3
        with:
          name: ${{ matrix.artifact_name }}_firmware
          path: |
            firmware/*.uf2
            firmware/*.bin
